import React, { useState, useEffect } from "react";

const malla = {
  "1": [
    { codigo: "BIMI030", nombre: "BIOLOGIA CELULAR", prerrequisitos: [], abre_a: ["FARM101", "HIPA104", "FARM155"] },
    { codigo: "CIAN040", nombre: "ZOOLOGIA Y ECOLOGIA APLICADA", prerrequisitos: [], abre_a: ["CIAN141"] },
    { codigo: "DYRE070", nombre: "EDUCACIÓN FÍSICA Y SALUD", prerrequisitos: [], abre_a: [] },
    { codigo: "ELECT12", nombre: "OFG 1", prerrequisitos: [], abre_a: [] },
    { codigo: "MATM003", nombre: "ELEMENTOS DE CALCULO", prerrequisitos: [], abre_a: ["MEPR132"] },
    { codigo: "MVET013", nombre: "PRACTICA INTRODUCCION A LA MEDICINA VETERINARIA I", prerrequisitos: [], abre_a: ["MVET053"] },
    { codigo: "QUIM007", nombre: "QUIMICA GENERAL", prerrequisitos: [], abre_a: [] }
  ],
  // ... resto de semestres igual que antes ...
};

function MallaCurricular() {
  const [asignaturasAprobadas, setAsignaturasAprobadas] = useState(() => {
    const saved = localStorage.getItem("aprobadas");
    return saved ? JSON.parse(saved) : [];
  });
  const [seleccionada, setSeleccionada] = useState(null);
  const [busqueda, setBusqueda] = useState("");

  useEffect(() => {
    localStorage.setItem("aprobadas", JSON.stringify(asignaturasAprobadas));
  }, [asignaturasAprobadas]);

  function toggleAprobada(codigo) {
    setAsignaturasAprobadas((prev) =>
      prev.includes(codigo)
        ? prev.filter((c) => c !== codigo)
        : [...prev, codigo]
    );
  }

  function filtrarAsignaturas(asig) {
    if (!busqueda) return true;
    const b = busqueda.toLowerCase();
    return (
      asig.nombre.toLowerCase().includes(b) || asig.codigo.toLowerCase().includes(b)
    );
  }

  return (
    <div style={{
      display: "flex",
      height: "100vh",
      fontFamily: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
      backgroundColor: "#f9fff9",
      color: "#2e7d32",
      userSelect: "none"
    }}>
      <div style={{
        flex: 1,
        overflowX: "auto",
        padding: 15,
        display: "flex",
        gap: 20
      }}>
        {Object.entries(malla).map(([semestre, asignaturas]) => (
          <div
            key={semestre}
            style={{
              minWidth: 240,
              backgroundColor: "#e8f5e9",
              borderRadius: 10,
              boxShadow: "0 4px 8px rgba(0,0,0,0.1)",
              padding: 15,
              borderLeft: "5px solid #388e3c",
              display: "flex",
              flexDirection: "column"
            }}
          >
            <h2 style={{
              textAlign: "center",
              marginBottom: 15,
              fontWeight: "700",
              fontSize: 22,
              color: "#1b5e20",
              textShadow: "1px 1px 2px #a5d6a7"
            }}>
              Semestre {semestre}
            </h2>

            {asignaturas.filter(filtrarAsignaturas).map((asig) => {
              const aprobada = asignaturasAprobadas.includes(asig.codigo);
              return (
                <div
                  key={asig.codigo}
                  onClick={() => setSeleccionada(asig)}
                  onDoubleClick={() => toggleAprobada(asig.codigo)}
                  title="Clic para detalles, doble clic para marcar aprobado"
                  style={{
                    cursor: "pointer",
                    marginBottom: 12,
                    padding: 12,
                    backgroundColor: aprobada ? "#a5d6a7" : "#dcedc8",
                    border: aprobada ? "2px solid #2e7d32" : "1.5px solid #81c784",
                    borderRadius: 8,
                    boxShadow: aprobada
                      ? "0 0 10px 1px #4caf50"
                      : "0 2px 4px rgba(0,0,0,0.1)",
                    transition: "all 0.25s ease",
                    fontWeight: aprobada ? "700" : "500",
                    color: aprobada ? "#1b5e20" : "#2e7d32",
                    userSelect: "none"
                  }}
                  onMouseEnter={e => e.currentTarget.style.backgroundColor = aprobada ? "#9ccc65" : "#c5e1a5"}
                  onMouseLeave={e => e.currentTarget.style.backgroundColor = aprobada ? "#a5d6a7" : "#dcedc8"}
                >
                  <strong>{asig.codigo}</strong> — {asig.nombre}
                </div>
              );
            })}
          </div>
        ))}
      </div>

      <div
        style={{
          width: 360,
          backgroundColor: "#fafafa",
          borderLeft: "3px solid #a5d6a7",
          padding: 30,
          boxShadow: "-5px 0 20px rgba(0,0,0,0.05)",
          overflowY: "auto"
        }}
      >
        <h3 style={{ color: "#2e7d32", marginBottom: 15, fontWeight: "700" }}>Buscar Asignatura</h3>
        <input
          type="text"
          placeholder="Código o nombre..."
          value={busqueda}
          onChange={(e) => setBusqueda(e.target.value)}
          style={{
            width: "100%",
            padding: "10px 15px",
            fontSize: 16,
            marginBottom: 30,
            borderRadius: 8,
            border: "2px solid #a5d6a7",
            outline: "none",
            transition: "border-color 0.3s",
            boxSizing: "border-box"
          }}
          onFocus={e => e.target.style.borderColor = "#4caf50"}
          onBlur={e => e.target.style.borderColor = "#a5d6a7"}
        />

        {seleccionada ? (
          <>
            <h2 style={{ marginTop: 0, color: "#1b5e20" }}>{seleccionada.nombre}</h2>
            <p><b>Código:</b> {seleccionada.codigo}</p>
            <p>
              <b>Prerrequisitos:</b>{" "}
              {seleccionada.prerrequisitos.length > 0
                ? seleccionada.prerrequisitos.join(", ")
                : "Ninguno"}
            </p>
            <p>
              <b>Abre a:</b>{" "}
              {seleccionada.abre_a.length > 0
                ? seleccionada.abre_a.join(", ")
                : "Ninguno"}
            </p>
            <button
              onClick={() => toggleAprobada(seleccionada.codigo)}
              style={{
                marginTop: 20,
                padding: "12px 20px",
                backgroundColor: asignaturasAprobadas.includes(seleccionada.codigo)
                  ? "#388e3c"
                  : "#a5d6a7",
                color: "white",
                border: "none",
                borderRadius: 10,
                cursor: "pointer",
                fontWeight: "700",
                fontSize: 16,
                boxShadow: "0 4px 10px rgba(56,142,60,0.6)",
                transition: "background-color 0.3s"
              }}
              onMouseEnter={e => e.currentTarget.style.backgroundColor = asignaturasAprobadas.includes(seleccionada.codigo) ? "#2e7d32" : "#81c784"}
              onMouseLeave={e => e.currentTarget.style.backgroundColor = asignaturasAprobadas.includes(seleccionada.codigo) ? "#388e3c" : "#a5d6a7"}
            >
              {asignaturasAprobadas.includes(seleccionada.codigo)
                ? "Marcar como NO aprobado"
                : "Marcar como aprobado"}
            </button>
          </>
        ) : (
          <p style={{ fontStyle: "italic", color: "#558b2f" }}>Haz clic en una asignatura para ver detalles.</p>
        )}
      </div>
    </div>
  );
}

export default MallaCurricular;
